<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mahasiswa • Biodata</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 + ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX (dev-only) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50 text-gray-900 min-h-dvh">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      function App() {
        const [data, setData] = useState([]);
        const [state, setState] = useState('loading'); // loading | ready | error
        const [q, setQ] = useState('');
        const [sort, setSort] = useState('id-asc');

        async function load() {
          setState('loading');
          try {
            const res = await fetch('/api/biodata');
            if (!res.ok) throw new Error('HTTP ' + res.status);
            const json = await res.json();
            setData(json);
            setState('ready');
          } catch (e) {
            console.error(e);
            setState('error');
          }
        }

        useEffect(() => { load(); }, []);

        const view = useMemo(() => {
          let v = data;
          const needle = q.trim().toLowerCase();
          if (needle) {
            v = v.filter(r => `${r.nama} ${r.nim} ${r.kelas}`.toLowerCase().includes(needle));
          }
          const [field, dir] = sort.split('-');
          v = [...v].sort((a, b) => {
            const A = String(a[field] ?? '').toLowerCase();
            const B = String(b[field] ?? '').toLowerCase();
            if (A < B) return dir === 'asc' ? -1 : 1;
            if (A > B) return dir === 'asc' ? 1 : -1;
            return 0;
          });
          return v;
        }, [data, q, sort]);

        return (
          <div>
            <header className="px-5 py-6 border-b bg-white sticky top-0 z-10">
              <div className="max-w-5xl mx-auto flex items-center justify-between gap-3">
                <h1 className="text-2xl font-bold">Biodata Mahasiswa</h1>
                <a className="text-sm text-blue-600 hover:underline" href="/">API Root</a>
              </div>
            </header>

            <main className="max-w-5xl mx-auto p-5">
              <div className="mb-4 flex flex-col sm:flex-row items-start sm:items-center gap-3 justify-between">
                <div className="flex items-center gap-2">
                  <input
                    value={q}
                    onChange={e => setQ(e.target.value)}
                    placeholder="Cari nama / NIM / kelas…"
                    className="w-72 px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <button onClick={() => setQ('')} className="px-3 py-2 rounded-lg border text-sm hover:bg-gray-100">Bersihkan</button>
                </div>
                <div className="flex items-center gap-2">
                  <label className="text-sm text-gray-600">Sortir:</label>
                  <select value={sort} onChange={e => setSort(e.target.value)} className="px-3 py-2 rounded-lg border border-gray-300">
                    <option value="id-asc">ID ↑</option>
                    <option value="id-desc">ID ↓</option>
                    <option value="nama-asc">Nama A–Z</option>
                    <option value="nama-desc">Nama Z–A</option>
                    <option value="nim-asc">NIM ↑</option>
                    <option value="nim-desc">NIM ↓</option>
                    <option value="kelas-asc">Kelas ↑</option>
                    <option value="kelas-desc">Kelas ↓</option>
                  </select>
                </div>
              </div>

              <div className="bg-white border rounded-2xl shadow-sm overflow-hidden">
                {state === 'loading' && (
                  <div className="p-6 text-center text-gray-600">Memuat data…</div>
                )}
                {state === 'error' && (
                  <div className="p-6 text-center text-red-600">Gagal memuat data. <button className="underline" onClick={load}>Coba lagi</button></div>
                )}
                {state === 'ready' && view.length === 0 && (
                  <div className="p-6 text-center text-gray-600">Tidak ada data.</div>
                )}
                {state === 'ready' && view.length > 0 && (
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-sm">
                      <thead className="bg-gray-50 border-b">
                        <tr>
                          <th className="text-left px-4 py-3 font-semibold text-gray-700">ID</th>
                          <th className="text-left px-4 py-3 font-semibold text-gray-700">Nama</th>
                          <th className="text-left px-4 py-3 font-semibold text-gray-700">NIM</th>
                          <th className="text-left px-4 py-3 font-semibold text-gray-700">Kelas</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y">
                        {view.map(r => (
                          <tr key={r.id} className="hover:bg-gray-50">
                            <td className="px-4 py-3">{r.id}</td>
                            <td className="px-4 py-3 font-medium">{r.nama}</td>
                            <td className="px-4 py-3">{r.nim}</td>
                            <td className="px-4 py-3">{r.kelas}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            </main>

            <footer className="max-w-5xl mx-auto p-6 text-xs text-gray-500">
              Sumber data: <code>/api/biodata</code>
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
